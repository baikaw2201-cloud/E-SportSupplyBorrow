<!doctype html>
<html lang="th" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏µ‡∏¨‡∏≤</title>
  <script src="https://cdn.tailwindcss.com/3.4.17"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
  <style>
        * { font-family: 'Prompt', sans-serif; }
        .tab-active { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); color: white; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-5px); box-shadow: 0 20px 40px rgba(0,0,0,0.15); }
        .equipment-card { background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%); }
        .btn-primary { background: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%); }
        .btn-primary:hover { background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%); }
        .btn-success { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .btn-danger { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-approved { background: #d1fae5; color: #065f46; }
        .status-returned { background: #dbeafe; color: #1e40af; }
        .modal-backdrop { background: rgba(0,0,0,0.6); backdrop-filter: blur(4px); }
        .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .toast { animation: slideIn 0.3s ease, fadeOut 0.3s ease 2.7s; }
        @keyframes slideIn { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes fadeOut { from { opacity: 1; } to { opacity: 0; } }
        .loading { display: inline-block; animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
    </style>
  <style>body { box-sizing: border-box; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-gray-100">
  <div id="app" class="h-full overflow-auto"><!-- Header -->
   <header class="gradient-bg text-white shadow-lg sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 py-4">
     <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
       <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center">
        <svg class="w-8 h-8" fill="currentColor" viewbox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z" />
        </svg>
       </div>
       <div>
        <h1 id="site-title" class="text-xl font-bold">‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏µ‡∏¨‡∏≤</h1>
        <p id="school-name" class="text-sm text-white/80">‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
       </div>
      </div><button id="admin-toggle" class="px-4 py-2 bg-white/20 hover:bg-white/30 rounded-lg text-sm font-medium transition-all"> üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô </button>
     </div>
    </div>
   </header><!-- Navigation Tabs -->
   <nav class="bg-white shadow-md sticky top-20 z-30">
    <div class="max-w-7xl mx-auto px-4">
     <div class="flex gap-2 py-3 flex-wrap"><button class="tab-btn tab-active px-6 py-3 rounded-xl font-medium transition-all" data-tab="borrow"> üì¶ ‡∏¢‡∏∑‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå </button> <button class="tab-btn px-6 py-3 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-all" data-tab="return"> üîÑ ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå </button> <button class="tab-btn hidden px-6 py-3 rounded-xl font-medium bg-gray-100 hover:bg-gray-200 transition-all" data-tab="admin" id="admin-tab"> üë®‚Äçüíº ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö </button>
     </div>
    </div>
   </nav><!-- Toast Container -->
   <div id="toast-container" class="fixed top-24 right-4 z-50 space-y-2"></div><!-- Main Content -->
   <main class="max-w-7xl mx-auto px-4 py-6"><!-- Borrow Tab -->
    <section id="borrow-section" class="tab-content">
     <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</h2>
      <p class="text-gray-600">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</p>
     </div>
     <div id="equipment-grid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"><!-- Equipment cards will be rendered here -->
     </div>
    </section><!-- Return Tab -->
    <section id="return-section" class="tab-content hidden">
     <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h2>
      <p class="text-gray-600">‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà</p>
     </div><!-- Search Student -->
     <div class="bg-white rounded-2xl shadow-lg p-6 mb-6">
      <div class="flex gap-4 flex-wrap"><input type="text" id="search-student-id" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô" class="flex-1 min-w-48 px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all"> <button id="search-btn" class="btn-primary px-6 py-3 text-white rounded-xl font-medium hover:shadow-lg transition-all"> üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ </button>
      </div>
     </div><!-- Student Borrows List -->
     <div id="student-borrows" class="space-y-4"><!-- Borrowed items will be rendered here -->
     </div>
    </section><!-- Admin Tab -->
    <section id="admin-section" class="tab-content hidden">
     <div class="mb-6">
      <h2 class="text-2xl font-bold text-gray-800 mb-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <p class="text-gray-600">‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô</p>
     </div><!-- Stats Cards -->
     <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-4 text-white">
       <p class="text-sm opacity-80">‡∏¢‡∏∑‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
       <p id="stat-total" class="text-3xl font-bold">0</p>
      </div>
      <div class="bg-gradient-to-br from-yellow-500 to-orange-500 rounded-2xl p-4 text-white">
       <p class="text-sm opacity-80">‡∏£‡∏≠‡∏Ñ‡∏∑‡∏ô</p>
       <p id="stat-pending" class="text-3xl font-bold">0</p>
      </div>
      <div class="bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl p-4 text-white">
       <p class="text-sm opacity-80">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>
       <p id="stat-waiting" class="text-3xl font-bold">0</p>
      </div>
      <div class="bg-gradient-to-br from-green-500 to-emerald-500 rounded-2xl p-4 text-white">
       <p class="text-sm opacity-80">‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>
       <p id="stat-returned" class="text-3xl font-bold">0</p>
      </div>
     </div><!-- Filter Tabs -->
     <div class="flex gap-2 mb-4 flex-wrap"><button class="filter-btn px-4 py-2 bg-blue-500 text-white rounded-lg text-sm font-medium" data-filter="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button> <button class="filter-btn px-4 py-2 bg-gray-200 rounded-lg text-sm font-medium" data-filter="borrowed">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°</button> <button class="filter-btn px-4 py-2 bg-gray-200 rounded-lg text-sm font-medium" data-filter="pending">‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button> <button class="filter-btn px-4 py-2 bg-gray-200 rounded-lg text-sm font-medium" data-filter="returned">‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</button>
     </div><!-- All Borrows List -->
     <div id="all-borrows" class="space-y-4"><!-- All borrow records will be rendered here -->
     </div>
    </section>
   </main><!-- Borrow Modal -->
   <div id="borrow-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-backdrop absolute inset-0" onclick="closeBorrowModal()"></div>
    <div class="absolute inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:w-full md:max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden">
     <div class="gradient-bg p-6 text-white">
      <h3 class="text-xl font-bold">‡∏¢‡∏∑‡∏°‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h3>
      <p id="modal-equipment-name" class="text-white/80"></p>
     </div>
     <form id="borrow-form" class="p-6 space-y-4"><input type="hidden" id="borrow-equipment-id">
      <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label> <input type="text" id="student-name" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</label> <input type="text" id="student-id" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô">
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°</label> <input type="number" id="borrow-quantity" min="1" value="1" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all">
       <p id="available-stock" class="text-sm text-gray-500 mt-1"></p>
      </div>
      <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô</label> <input type="date" id="return-date" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all">
      </div>
      <div class="flex gap-3 pt-4"><button type="button" onclick="closeBorrowModal()" class="flex-1 px-4 py-3 bg-gray-200 hover:bg-gray-300 rounded-xl font-medium transition-all"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> <button type="submit" id="submit-borrow-btn" class="flex-1 btn-primary px-4 py-3 text-white rounded-xl font-medium hover:shadow-lg transition-all"> ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏° </button>
      </div>
     </form>
    </div>
   </div><!-- Return Modal -->
   <div id="return-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-backdrop absolute inset-0" onclick="closeReturnModal()"></div>
    <div class="absolute inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:w-full md:max-w-md bg-white rounded-2xl shadow-2xl overflow-hidden">
     <div class="bg-gradient-to-r from-green-500 to-emerald-500 p-6 text-white">
      <h3 class="text-xl font-bold">‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå</h3>
      <p id="return-modal-info" class="text-white/80"></p>
     </div>
     <form id="return-form" class="p-6 space-y-4"><input type="hidden" id="return-borrow-id">
      <div><label class="block text-sm font-medium text-gray-700 mb-2">‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô</label>
       <div class="border-2 border-dashed border-gray-300 rounded-xl p-4 text-center hover:border-blue-500 transition-all cursor-pointer" onclick="document.getElementById('return-photo').click()"><input type="file" id="return-photo" accept="image/*" capture="environment" class="hidden" onchange="previewReturnPhoto(event)">
        <div id="photo-preview" class="hidden"><img id="preview-img" class="max-h-48 mx-auto rounded-lg">
        </div>
        <div id="photo-placeholder">
         <div class="text-4xl mb-2">
          üì∑
         </div>
         <p class="text-gray-500">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</p>
        </div>
       </div>
      </div>
      <div class="flex gap-3 pt-4"><button type="button" onclick="closeReturnModal()" class="flex-1 px-4 py-3 bg-gray-200 hover:bg-gray-300 rounded-xl font-medium transition-all"> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å </button> <button type="submit" id="submit-return-btn" class="flex-1 btn-success px-4 py-3 text-white rounded-xl font-medium hover:shadow-lg transition-all"> ‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô </button>
      </div>
     </form>
    </div>
   </div><!-- Image View Modal -->
   <div id="image-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-backdrop absolute inset-0" onclick="closeImageModal()"></div>
    <div class="absolute inset-4 md:inset-8 flex items-center justify-center"><img id="modal-image" class="max-w-full max-h-full rounded-2xl shadow-2xl"> <button onclick="closeImageModal()" class="absolute top-2 right-2 w-10 h-10 bg-white/90 rounded-full flex items-center justify-center text-xl hover:bg-white transition-all">‚úï</button>
    </div>
   </div><!-- Admin Login Modal -->
   <div id="admin-login-modal" class="fixed inset-0 z-50 hidden">
    <div class="modal-backdrop absolute inset-0" onclick="closeAdminLogin()"></div>
    <div class="absolute inset-4 md:inset-auto md:top-1/2 md:left-1/2 md:-translate-x-1/2 md:-translate-y-1/2 md:w-full md:max-w-sm bg-white rounded-2xl shadow-2xl overflow-hidden">
     <div class="gradient-bg p-6 text-white">
      <h3 class="text-xl font-bold">üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô</h3>
     </div>
     <form id="admin-login-form" class="p-6 space-y-4">
      <div><label class="block text-sm font-medium text-gray-700 mb-1">‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label> <input type="password" id="admin-password" required class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none transition-all" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô">
      </div>
      <p class="text-xs text-gray-500">üí° ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: admin123</p><button type="submit" class="w-full btn-primary px-4 py-3 text-white rounded-xl font-medium hover:shadow-lg transition-all"> ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö </button>
     </form>
    </div>
   </div>
  </div>
  <script>
        // ==================== FIREBASE CONFIG ====================
        const firebaseConfig = {
            apiKey: "AIzaSyCCcPHPBC3GYPB2UZIrlfOOuf6nZh_giAk",
            authDomain: "e-sportsupply-borrowing.firebaseapp.com",
            databaseURL: "https://e-sportsupply-borrowing-default-rtdb.firebaseio.com",
            projectId: "e-sportsupply-borrowing",
            storageBucket: "e-sportsupply-borrowing.firebasestorage.app",
            messagingSenderId: "572790206354",
            appId: "1:572790206354:web:8fb3a3c220494554b8db4b",
            measurementId: "G-NC0WZTT9R6"
        };

        // Initialize Firebase
        let db, storage;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            storage = firebase.storage();
        } catch (error) {
            console.error("Firebase initialization error:", error);
        }

        // ==================== APP STATE ====================
        let isAdmin = false;
        let currentFilter = 'all';
        let allBorrows = [];

        // ==================== EQUIPMENT DATA ====================
        const equipmentList = [
            { id: 'football', name: '‡∏•‡∏π‡∏Å‡∏ü‡∏∏‡∏ï‡∏ö‡∏≠‡∏•', icon: '‚öΩ', color: 'from-green-400 to-green-600' },
            { id: 'basketball', name: '‡∏•‡∏π‡∏Å‡∏ö‡∏≤‡∏™‡πÄ‡∏Å‡∏ï‡∏ö‡∏≠‡∏•', icon: 'üèÄ', color: 'from-orange-400 to-orange-600' },
            { id: 'volleyball', name: '‡∏•‡∏π‡∏Å‡∏ß‡∏≠‡∏•‡πÄ‡∏•‡∏¢‡πå‡∏ö‡∏≠‡∏•', icon: 'üèê', color: 'from-yellow-400 to-yellow-600' },
            { id: 'badminton', name: '‡πÑ‡∏°‡πâ‡πÅ‡∏ö‡∏î‡∏°‡∏¥‡∏ô‡∏ï‡∏±‡∏ô', icon: 'üè∏', color: 'from-blue-400 to-blue-600' },
            { id: 'tabletennis', name: '‡πÑ‡∏°‡πâ‡∏õ‡∏¥‡∏á‡∏õ‡∏≠‡∏á', icon: 'üèì', color: 'from-red-400 to-red-600' },
            { id: 'takraw', name: '‡∏•‡∏π‡∏Å‡∏ï‡∏∞‡∏Å‡∏£‡πâ‡∏≠', icon: 'üîµ', color: 'from-purple-400 to-purple-600' },
            { id: 'rope', name: '‡πÄ‡∏ä‡∏∑‡∏≠‡∏Å‡∏Å‡∏£‡∏∞‡πÇ‡∏î‡∏î', icon: 'ü™¢', color: 'from-pink-400 to-pink-600' },
            { id: 'hulahoop', name: '‡∏Æ‡∏π‡∏•‡πà‡∏≤‡∏Æ‡∏π‡∏õ', icon: '‚≠ï', color: 'from-cyan-400 to-cyan-600' }
        ];

        // ==================== ELEMENT SDK ====================
        const defaultConfig = {
            site_title: '‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏∑‡∏°-‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏µ‡∏¨‡∏≤',
            school_name: '‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì'
        };

        if (window.elementSdk) {
            window.elementSdk.init({
                defaultConfig,
                onConfigChange: async (config) => {
                    document.getElementById('site-title').textContent = config.site_title || defaultConfig.site_title;
                    document.getElementById('school-name').textContent = config.school_name || defaultConfig.school_name;
                },
                mapToCapabilities: (config) => ({
                    recolorables: [],
                    borderables: [],
                    fontEditable: undefined,
                    fontSizeable: undefined
                }),
                mapToEditPanelValues: (config) => new Map([
                    ['site_title', config.site_title || defaultConfig.site_title],
                    ['school_name', config.school_name || defaultConfig.school_name]
                ])
            });
        }

        // ==================== UTILITY FUNCTIONS ====================
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            const bgColor = type === 'success' ? 'bg-green-500' : type === 'error' ? 'bg-red-500' : 'bg-blue-500';
            toast.className = `toast ${bgColor} text-white px-6 py-3 rounded-xl shadow-lg font-medium`;
            toast.textContent = message;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function formatDate(dateStr) {
            if (!dateStr) return '-';
            const date = new Date(dateStr);
            return date.toLocaleDateString('th-TH', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function getStatusBadge(status) {
            switch(status) {
                case 'borrowed': return '<span class="status-pending px-3 py-1 rounded-full text-sm font-medium">üì¶ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡∏∑‡∏°</span>';
                case 'pending': return '<span class="bg-purple-100 text-purple-800 px-3 py-1 rounded-full text-sm font-medium">‚è≥ ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</span>';
                case 'returned': return '<span class="status-approved px-3 py-1 rounded-full text-sm font-medium">‚úÖ ‡∏Ñ‡∏∑‡∏ô‡πÅ‡∏•‡πâ‡∏ß</span>';
                default: return '';
            }
        }

        // ==================== RENDER FUNCTIONS ====================
        function renderEquipmentGrid() {
            const grid = document.getElementById('equipment-grid');
            grid.innerHTML = equipmentList.map(eq => `
                <div class="equipment-card card-hover rounded-2xl shadow-lg overflow-hidden cursor-pointer" onclick="openBorrowModal('${eq.id}')">
                    <div class="bg-gradient-to-br ${eq.color} p-6 text-white text-center">
                        <div class="text-5xl mb-2">${eq.icon}</div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-gray-800">${eq.name}</h3>
                        <p class="text-sm text-gray-500">‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏¢‡∏∑‡∏°</p>
                    </div>
                </div>
            `).join('');
        }

        async function renderStudentBorrows(studentId) {
            const container = document.getElementById('student-borrows');
            container.innerHTML = '<div class="text-center py-8"><div class="animate-spin text-4xl">‚è≥</div><p class="text-gray-500 mt-2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...</p></div>';

            try {
                const snapshot = await db.collection('borrows')
                    .where('studentId', '==', studentId)
                    .where('status', 'in', ['borrowed', 'pending'])
                    .get();

                if (snapshot.empty) {
                    container.innerHTML = '<div class="bg-white rounded-2xl shadow-lg p-8 text-center"><p class="text-gray-500">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏¢‡∏∑‡∏°‡∏≠‡∏¢‡∏π‡πà</p></div>';
                    return;
                }

                const borrows = [];
                snapshot.forEach(doc => borrows.push({ id: doc.id, ...doc.data() }));

                container.innerHTML = borrows.map(b => {
                    const equipment = equipmentList.find(e => e.id === b.equipmentId) || { name: b.equipmentId, icon: 'üì¶' };
                    return `
                        <div class="bg-white rounded-2xl shadow-lg p-4">
                            <div class="flex items-center justify-between flex-wrap gap-4">
                                <div class="flex items-center gap-4">
                                    <div class="text-4xl">${equipment.icon}</div>
                                    <div>
                                        <h3 class="font-bold text-gray-800">${equipment.name}</h3>
                                        <p class="text-sm text-gray-500">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: ${b.quantity} ‡∏ä‡∏¥‡πâ‡∏ô | ‡∏Ñ‡∏∑‡∏ô‡∏†‡∏≤‡∏¢‡πÉ‡∏ô: ${formatDate(b.returnDate)}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    ${getStatusBadge(b.status)}
                                    ${b.status === 'borrowed' ? `
                                        <button onclick="openReturnModal('${b.id}', '${equipment.name}')" 
                                            class="mt-2 btn-success px-4 py-2 text-white rounded-lg text-sm font-medium block w-full">
                                            üì∑ ‡∏Ñ‡∏∑‡∏ô‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå
                                        </button>
                                    ` : '<p class="text-sm text-purple-600 mt-2">‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</p>'}
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
            } catch (error) {
                console.error("Error fetching borrows:", error);
                container.innerHTML = '<div class="bg-red-50 rounded-2xl p-8 text-center"><p class="text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</p></div>';
            }
        }

        async function renderAllBorrows() {
            const container = document.getElementById('all-borrows');
            container.innerHTML = '<div class="text-center py-8"><div class="animate-spin text-4xl">‚è≥</div></div>';

            try {
                const snapshot = await db.collection('borrows').orderBy('borrowDate', 'desc').get();
                allBorrows = [];
                snapshot.forEach(doc => allBorrows.push({ id: doc.id, ...doc.data() }));
                
                updateStats();
                filterAndRenderBorrows();
            } catch (error) {
                console.error("Error fetching all borrows:", error);
                container.innerHTML = '<div class="bg-red-50 rounded-2xl p-8 text-center"><p class="text-red-500">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î</p></div>';
            }
        }

        function updateStats() {
            document.getElementById('stat-total').textContent = allBorrows.length;
            document.getElementById('stat-pending').textContent = allBorrows.filter(b => b.status === 'borrowed').length;
            document.getElementById('stat-waiting').textContent = allBorrows.filter(b => b.status === 'pending').length;
            document.getElementById('stat-returned').textContent = allBorrows.filter(b => b.status === 'returned').length;
        }

        function filterAndRenderBorrows() {
            const container = document.getElementById('all-borrows');
            let filtered = allBorrows;

            if (currentFilter !== 'all') {
                filtered = allBorrows.filter(b => b.status === currentFilter);
            }

            if (filtered.length === 0) {
                container.innerHTML = '<div class="bg-white rounded-2xl shadow-lg p-8 text-center"><p class="text-gray-500">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</p></div>';
                return;
            }

            container.innerHTML = filtered.map(b => {
                const equipment = equipmentList.find(e => e.id === b.equipmentId) || { name: b.equipmentId, icon: 'üì¶' };
                return `
                    <div class="bg-white rounded-2xl shadow-lg p-4">
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div class="flex items-center gap-4">
                                <div class="text-4xl">${equipment.icon}</div>
                                <div>
                                    <h3 class="font-bold text-gray-800">${equipment.name} x${b.quantity}</h3>
                                    <p class="text-sm text-gray-600">${b.studentName} (${b.studentId})</p>
                                    <p class="text-xs text-gray-400">‡∏¢‡∏∑‡∏°: ${formatDate(b.borrowDate)} | ‡∏Ñ‡∏∑‡∏ô: ${formatDate(b.returnDate)}</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2 flex-wrap">
                                ${getStatusBadge(b.status)}
                                ${b.status === 'pending' && b.returnPhotoUrl ? `
                                    <button onclick="viewImage('${b.returnPhotoUrl}')" class="px-3 py-2 bg-blue-100 text-blue-700 rounded-lg text-sm font-medium hover:bg-blue-200">
                                        üñºÔ∏è ‡∏î‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô
                                    </button>
                                    <button onclick="approveReturn('${b.id}')" class="px-3 py-2 bg-green-500 text-white rounded-lg text-sm font-medium hover:bg-green-600">
                                        ‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥
                                    </button>
                                ` : ''}
                                ${b.status === 'returned' && b.returnPhotoUrl ? `
                                    <button onclick="viewImage('${b.returnPhotoUrl}')" class="px-3 py-2 bg-gray-100 text-gray-700 rounded-lg text-sm font-medium hover:bg-gray-200">
                                        üñºÔ∏è ‡∏î‡∏π‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ==================== MODAL FUNCTIONS ====================
        function openBorrowModal(equipmentId) {
            const equipment = equipmentList.find(e => e.id === equipmentId);
            if (!equipment) return;

            document.getElementById('borrow-equipment-id').value = equipmentId;
            document.getElementById('modal-equipment-name').textContent = `${equipment.icon} ${equipment.name}`;
            document.getElementById('available-stock').textContent = `‚úÖ ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏¢‡∏∑‡∏°`;
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('return-date').min = today;
            
            document.getElementById('borrow-modal').classList.remove('hidden');
        }

        function closeBorrowModal() {
            document.getElementById('borrow-modal').classList.add('hidden');
            document.getElementById('borrow-form').reset();
        }

        function openReturnModal(borrowId, equipmentName) {
            document.getElementById('return-borrow-id').value = borrowId;
            document.getElementById('return-modal-info').textContent = equipmentName;
            document.getElementById('photo-preview').classList.add('hidden');
            document.getElementById('photo-placeholder').classList.remove('hidden');
            document.getElementById('return-photo').value = '';
            document.getElementById('return-modal').classList.remove('hidden');
        }

        function closeReturnModal() {
            document.getElementById('return-modal').classList.add('hidden');
            document.getElementById('return-form').reset();
        }

        function previewReturnPhoto(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-img').src = e.target.result;
                    document.getElementById('photo-preview').classList.remove('hidden');
                    document.getElementById('photo-placeholder').classList.add('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function viewImage(url) {
            document.getElementById('modal-image').src = url;
            document.getElementById('image-modal').classList.remove('hidden');
        }

        function closeImageModal() {
            document.getElementById('image-modal').classList.add('hidden');
        }

        function closeAdminLogin() {
            document.getElementById('admin-login-modal').classList.add('hidden');
        }

        // ==================== FORM HANDLERS ====================
        document.getElementById('borrow-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submit-borrow-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

            const borrowData = {
                equipmentId: document.getElementById('borrow-equipment-id').value,
                studentName: document.getElementById('student-name').value,
                studentId: document.getElementById('student-id').value,
                quantity: parseInt(document.getElementById('borrow-quantity').value),
                returnDate: document.getElementById('return-date').value,
                borrowDate: new Date().toISOString(),
                status: 'borrowed'
            };

            try {
                await db.collection('borrows').add(borrowData);
                showToast('‚úÖ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                closeBorrowModal();
            } catch (error) {
                console.error("Error adding borrow:", error);
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏°';
            }
        });

        document.getElementById('return-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const btn = document.getElementById('submit-return-btn');
            const file = document.getElementById('return-photo').files[0];
            const borrowId = document.getElementById('return-borrow-id').value;

            if (!file) {
                showToast('‚ùå ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ñ‡πà‡∏≤‡∏¢‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô', 'error');
                return;
            }

            btn.disabled = true;
            btn.textContent = '‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...';

            try {
                // Upload image to Firebase Storage
                const storageRef = storage.ref(`returns/${borrowId}_${Date.now()}`);
                const snapshot = await storageRef.put(file);
                const downloadUrl = await snapshot.ref.getDownloadURL();

                // Update borrow record
                await db.collection('borrows').doc(borrowId).update({
                    status: 'pending',
                    returnPhotoUrl: downloadUrl,
                    returnRequestDate: new Date().toISOString()
                });

                showToast('‚úÖ ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏Ñ‡∏∑‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏£‡∏≠‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥');
                closeReturnModal();
                
                // Refresh student borrows
                const studentId = document.getElementById('search-student-id').value;
                if (studentId) renderStudentBorrows(studentId);
            } catch (error) {
                console.error("Error submitting return:", error);
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = '‚úÖ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô';
            }
        });

        document.getElementById('search-btn').addEventListener('click', () => {
            const studentId = document.getElementById('search-student-id').value.trim();
            if (studentId) {
                renderStudentBorrows(studentId);
            } else {
                showToast('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô', 'error');
            }
        });

        document.getElementById('admin-login-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const password = document.getElementById('admin-password').value;
            
            // Simple password check
            if (password === 'admin123') {
                isAdmin = true;
                document.getElementById('admin-tab').classList.remove('hidden');
                document.getElementById('admin-toggle').textContent = 'üë®‚Äçüíº ‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô';
                closeAdminLogin();
                showToast('‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                switchTab('admin');
                renderAllBorrows();
            } else {
                showToast('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            }
        });

        // ==================== ADMIN FUNCTIONS ====================
        async function approveReturn(borrowId) {
            try {
                await db.collection('borrows').doc(borrowId).update({
                    status: 'returned',
                    approvedDate: new Date().toISOString()
                });
                showToast('‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ñ‡∏∑‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                renderAllBorrows();
            } catch (error) {
                console.error("Error approving return:", error);
                showToast('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î', 'error');
            }
        }

        // ==================== TAB NAVIGATION ====================
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('tab-active');
                btn.classList.add('bg-gray-100', 'hover:bg-gray-200');
            });
            const activeBtn = document.querySelector(`.tab-btn[data-tab="${tabName}"]`);
            if (activeBtn) {
                activeBtn.classList.add('tab-active');
                activeBtn.classList.remove('bg-gray-100', 'hover:bg-gray-200');
            }

            // Show/hide sections
            document.querySelectorAll('.tab-content').forEach(section => {
                section.classList.add('hidden');
            });
            document.getElementById(`${tabName}-section`).classList.remove('hidden');

            // Load data for admin tab
            if (tabName === 'admin' && isAdmin) {
                renderAllBorrows();
            }
        }

        document.querySelectorAll('.tab-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const tab = btn.dataset.tab;
                if (tab === 'admin' && !isAdmin) {
                    document.getElementById('admin-login-modal').classList.remove('hidden');
                    return;
                }
                switchTab(tab);
            });
        });

        document.getElementById('admin-toggle').addEventListener('click', () => {
            if (isAdmin) {
                switchTab('admin');
            } else {
                document.getElementById('admin-login-modal').classList.remove('hidden');
            }
        });

        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => {
                    b.classList.remove('bg-blue-500', 'text-white');
                    b.classList.add('bg-gray-200');
                });
                btn.classList.add('bg-blue-500', 'text-white');
                btn.classList.remove('bg-gray-200');
                currentFilter = btn.dataset.filter;
                filterAndRenderBorrows();
            });
        });

        // ==================== INITIALIZATION ====================
        renderEquipmentGrid();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cd143e0a0f5a18a',t:'MTc3MDk1MzYxNS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
